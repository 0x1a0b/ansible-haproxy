{% if haproxy_standard_application %}
frontend http-in
  bind :80

{% if haproxy_restricted_paths is iterable %}
{%   for restricted_path in haproxy_restricted_paths %}
  acl restricted_path path_beg {{ restricted_path }}
{%   endfor %}

{%   for allowed_ip in haproxy_allow_access_to_restricted_paths_from_ips %}
  acl allowed_ip src {{ allowed_ip }}
{%   endfor %}

  http-request deny if restricted_path !allowed_ip
{% endif %}

  default_backend {{ project }}-application

backend localhost
  server local 127.0.0.1

backend {{ project }}-application
{% if haproxy_ssl_force %}
  redirect scheme https code 301 if !{ ssl_fc }
{% endif %}
{% if environment_tier in ['staging', 'production'] %}
  server application-load-balancer application.{{ project }}-{{ environment_tier }}.teluswebteam.com{% if haproxy_ssl_enabled %}:80{% endif %}
  
  server application application-direct.{{ project }}-{{ environment_tier }}.teluswebteam.com disabled
{% else %}
  server application application.{{ project }}-{{ environment_tier }}.teluswebteam.com{% if haproxy_ssl_enabled %}:80{% endif %}
{% endif %}
{% endif %}
